<!doctype html>
<html lang="en">
<head>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
   
  <script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAPnTLVwPCAF9EzdwAIQmqSzK16eSbcOz4",
      authDomain: "webcraft-7f386.firebaseapp.com",
      databaseURL: "https://webcraft-7f386-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "webcraft-7f386",
      storageBucket: "webcraft-7f386.appspot.com",
      messagingSenderId: "983810632123",
      appId: "1:983810632123:web:def8d379daa38fbca42fc9e",
      measurementId: "G-WSSVHJ9VV3"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const analytics = firebase.analytics();
    const database = firebase.database();
    const auth = firebase.auth();

    // Function to log a page view
    const pageViewsRef = firebase.database().ref('analytics/page_views');
    console.log("Database Reference: ", pageViewsRef);
    function logPageView(pageName) {
      const pageViewData = {
        page: pageName,
        timestamp: Date.now()
      };
    
      // Push the page view data to the database
      pageViewsRef.push(pageViewData);
    }
    
    // Log a page view when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Ensure Firebase is initialized
      // logPageView('Analytics');
    });
    
  </script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="WebCraft Team">
  <link rel="shortcut icon" href="assets/trademark/logo_2.png">

  <meta name="description" content="" />
  <meta name="keywords" content="bootstrap, bootstrap4" />
    
  <!-- Bootstrap CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="css/tiny-slider.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
  <title>Analytics</title>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      background-size: cover;
      background-position: center;
      height: 100vh;
      background-color: white;
      background-image: url('assets/Pricing BG.png');
      background-size: cover;
      background-position: top;
      background-repeat: no-repeat;
    }

  </style>
</head>

<body>
  <script>
    !(function(){
      const sc = document.createElement('script');
      sc.src = "https://apps.voc.ai/api_v2/gpt/bots/livechat/embed.js?id=18683&token=670FDDE9E4B01122021603B5";
      sc.async = true;
      const s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(sc, s);
    })();
  </script>

  <!-- Start Header/Navigation -->
  <nav class="custom-navbar navbar navbar-expand-md navbar-dark bg-dark" aria-label="Furni navigation bar">
    <div class="container">
      <a class="navbar-brand" href="analytics.html">
        <img src="assets/trademark/logo_2.png" alt="WebCraft Logo" width="100" height="50">
      </a>
    </div>

    <!-- Profile Icon -->
    <div class="btn-circle btn-fixed" onclick="toggleMenu()">
      <i class="fas fa-user fa-2x"></i> 
    </div>
  </nav>

  <!-- Profile Menu -->
  <div class="profile-menu" id="profileMenu">
    <ul>
      <li><a href="#" onclick="toggleUserInfo()">Profile</a></li>
      <div id="userInfoDisplay" style="display: none;"></div>
      <div class="divider"></div>
      <li><a href="#" onclick="openChangePasswordModal(); toggleMenu();">Change Password</a></li>
      <div class="divider"></div>
      <li><a href="#" onclick="confirmLogout(); toggleMenu();">Log out</a></li>
    </ul>
  </div>

  <!-- Logout Modal -->
  <div id="logoutOverlay" class="overlay"></div>

  <div id="logoutModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div style="text-align:center;">
        <img src="assets/trademark4.png" alt="WebCraft Logo" width="120" height="135" style="display:inline-block;">
      </div>
      <p style="text-align: center;">Are you sure you want to log out?</p>
      <div class='btn-wrapper'>
        <button id='confirmLogoutBtn' class='modal-btn modal-btn-logout'>Log out</button>
        <button id='cancelLogoutBtn' class='modal-btn modal-btn-cancel'>Cancel</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id='changePasswordModal' class='modal' style='display:none;'>
    <div class='modal-content'>
      <div style='text-align:center;'>
        <h3>Change Password</h3>
      </div>
      <form id='changePasswordForm'>
        <div class="input-group">
          <input type='password' id='currentPassword' placeholder='Current Password' required>
          <i class="fas fa-eye-slash toggle-password" onclick="togglePasswordVisibility('currentPassword')"></i>
        </div>
        <div class="input-group">
          <input type='password' id='newPassword' placeholder='New Password' required>
          <i class="fas fa-eye-slash toggle-password" onclick="togglePasswordVisibility('newPassword')"></i>
        </div>
        <div class="input-group">
          <input type='password' id='confirmNewPassword' placeholder='Confirm New Password' required>
          <i class="fas fa-eye-slash toggle-password" onclick="togglePasswordVisibility('confirmNewPassword')"></i>
        </div>
        <div class='btn-wrapper'>
          <button type='submit' class='modal-btn modal-btn-submit'>Change Password</button>
          <button type='button' class='modal-btn modal-btn-cancel' onclick='closeChangePasswordModal()'>Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Alert Modal -->
  <div id="alertModal" class="modal" style="display:none;">
    <div class="modal-content">
      <div style="text-align:center;">
        <img src="assets/trademark4.png" alt="WebCraft Logo" width="120" height="135" style="display:inline-block;">
      </div>
      <p id="alertMessage" style="text-align: center;"></p>
      <div class='btn-wrapper'>
        <button id='alertOkBtn' class='modal-btn modal-btn-ok'>OK</button>
      </div>
    </div>
  </div>

  <!-- Start Hero Section -->
    <div class='container'>
      <img src="assets/analyticsText.png" alt="Feature" class="feature-image-1" style="align-items: start; width: 500px; height: auto;">
    </div>

  <div class='main-container'>
    <div class='card-container'>
      <!-- Active Users Section -->
      <div class='card-41'>
        <div class='active-users-title'>
          <h2 style='font-size:40px;font-weight:bold;'>Active Users</h2>
        </div>
        <div class='active-users'>
          <h2>Number of active users:</h2><br/>
          <span id='active-user-count' style='color:black;'>0</span>
        </div>
      </div>

      <!-- Page Views Section -->
      <div class='card-41' style='flex:2;'>
        <div class='page-views-title'>
          <h2 style='font-size:40px;font-weight:bold;'>Page Engagement</h2>
        </div>
        <div class='page-views' id='analytics-display'>
          <!-- Real-time analytics data will be displayed here -->
        </div>
      </div>
    </div>
  </div>

  <br/><br/><br/><br/><br/><br/>

  <!-- footer section -->
  <div class='footer-wrapper'>
    <footer>   
      <div class='footer-container'>   
        <div class='subscribe-section'><br/>
          <h3 style='font-size:medium;'>   
            <img src='assets/envelope-outline.svg' alt='Image' class='img-fluid'>   
            Send me tips, trends, freebies, updates & offers.   
          </h3>   
          <form id='subscribe-form' action='https://formsubmit.co/el/hocuya' method='POST' target='_blank' onSubmit='return submitForm();'>   
            <input type='email' name='email' placeholder='Your Email' required>   
            <button type='submit'>   
              <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-send'>   
                <line x1='22' y1='2' x2='11' y2='13'></line>   
                <polygon points='22 2 15 22 11 13 2 9'></polygon>   
              </svg>   
            </button>   
          </form>   
        </div>   
        <div class='footer-image'>   
          <img src='assets/trademark/webcraft animated.gif' alt='logo'>   
        </div>   
      </div>   
    </footer>   
    <div class='footer-bottom' style='background-color:#e0e0e0'>   
      <ul class='list-unstyled d-inline-flex ms-auto'>   
        <p>   
          <a href='#'>Terms &amp; Conditions | </a>   
          <a href='#'>Cookie Consent | </a>   
          <a href='#'>Privacy Policy | </a>   
          <a href='#'>Support | </a>    
          <a href='#'>Â© WebCraft Team 2024 </a>    
        </p>   
      </ul>    
    </div>    
  </div>
  <script defer src="/_vercel/insights/script.js"></script>
  <script src='js/bootstrap.bundle.min.js'></script>    
  <script src='js/tiny-slider.js'></script>    
  <script src='js/custom.js'></script>

  <script>
    function toggleMenu() {
      const menu = document.getElementById('profileMenu');
      const profileIcon = document.querySelector('.profile-icon');
      menu.classList.toggle('active');
      profileIcon.classList.toggle('active');
    }

    function toggleUserInfo() {
      const user = auth.currentUser;
      const userInfoDisplay = document.getElementById('userInfoDisplay');
      
      if (userInfoDisplay.style.display === 'none') {
        if (user) {
          userInfoDisplay.innerHTML = `
            <p><strong>Email:</strong> ${user.email}</p>
            <p><strong>Name:</strong> <span id="displayName">${user.displayName || 'Not set'}</span>
              <button id="editNameBtn" onclick="toggleEditName()">Edit</button>
            </p>
            <input type="text" id="editNameInput" style="display: none;">
            <button id="saveNameBtn" onclick="saveName()" style="display: none;">Save</button>
            <button id="exitNameBtn" onclick="cancelEditName()" style="display: none;">Exit</button>
          `;
          userInfoDisplay.style.display = 'block';
        } else {
          userInfoDisplay.innerHTML = '<p>User not logged in</p>';
          userInfoDisplay.style.display = 'block';
        }
      } else {
        userInfoDisplay.style.display = 'none';
      }
    }

    function toggleEditName() {
      const displayName = document.getElementById('displayName');
      const editNameBtn = document.getElementById('editNameBtn');
      const editNameInput = document.getElementById('editNameInput');
      const saveNameBtn = document.getElementById('saveNameBtn');
      const exitNameBtn = document.getElementById('exitNameBtn');

      if (editNameInput.style.display === 'none') {
        editNameInput.value = displayName.textContent;
        displayName.style.display = 'none';
        editNameBtn.style.display = 'none';
        editNameInput.style.display = 'inline-block';
        saveNameBtn.style.display = 'inline-block';
        exitNameBtn.style.display = 'inline-block';
      } else {
        displayName.style.display = 'inline';
        editNameBtn.style.display = 'inline-block';
        editNameInput.style.display = 'none';
        saveNameBtn.style.display = 'none';
        exitNameBtn.style.display = 'none';
      }
    }

    function cancelEditName() {
      toggleEditName();
    }

    function saveName() {
      const user = auth.currentUser;
      const newName = document.getElementById('editNameInput').value;

      user.updateProfile({
        displayName: newName
      }).then(() => {
        document.getElementById('displayName').textContent = newName;
        toggleEditName();
        showAlert("Name updated successfully!");
        
        // Update the name in the Realtime Database
        const userRef = database.ref('users/' + user.uid);
        userRef.update({
          displayName: newName
        });
      }).catch((error) => {
        console.error("Error updating name: ", error);
        showAlert("Error updating name. Please try again.");
      });
    }
    function confirmLogout() {
      // Get the modal and overlay elements
      const logoutModal = document.getElementById('logoutModal');
      const logoutOverlay = document.getElementById('logoutOverlay');
      
      // Show the modal and overlay
      logoutModal.style.display = 'block';
      logoutOverlay.style.display = 'block';
      
      // Add event listeners to the buttons
      document.getElementById('confirmLogoutBtn').addEventListener('click', function() {
        auth.signOut().then(() => {
          window.location.href = 'index.html'; // Redirect to the login page after logout
        }).catch((error) => {
          console.error('Sign out error: ', error);
        });
      });

      document.getElementById('cancelLogoutBtn').addEventListener('click', function() {
        // Hide the modal and overlay when cancel is clicked
        logoutModal.style.display = 'none';
        logoutOverlay.style.display = 'none';
      });
    }

    // Optional: Close modal if clicking outside of it
    window.onclick = function(event) {
      const logoutModal = document.getElementById('logoutModal');
      const logoutOverlay = document.getElementById('logoutOverlay');
      if (event.target === logoutOverlay) {
        logoutModal.style.display = 'none';
        logoutOverlay.style.display = 'none';
      }
    };

    function openChangePasswordModal() {
      document.getElementById("changePasswordModal").style.display = "block";
      document.getElementById("logoutOverlay").style.display = "block"; // Show overlay
      document.body.classList.add('modal-open'); // Add class to body
    }

    function closeChangePasswordModal() {
      document.getElementById("changePasswordModal").style.display = "none";
      document.getElementById("logoutOverlay").style.display = "none"; // Hide overlay
      document.body.classList.remove('modal-open'); // Remove class from body

      // Clear the input fields when the modal is closed
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmNewPassword').value = '';
    }

    function togglePasswordVisibility(inputId) {
      const input = document.getElementById(inputId);
      const icon = input.nextElementSibling;
      if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
      } else {
        input.type = "password";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
      }
    }

    function showAlert(message) {
      const alertModal = document.getElementById("alertModal");
      const alertMessage = document.getElementById("alertMessage");
      const alertOkBtn = document.getElementById("alertOkBtn");
      const overlay = document.getElementById("logoutOverlay");

      alertMessage.textContent = message;
      alertModal.style.display = "block";
      overlay.style.display = "block";
      document.body.classList.add('modal-open');

      alertOkBtn.onclick = function() {
        alertModal.style.display = "none";
        overlay.style.display = "none"; // Hide the overlay when OK is clicked
        document.body.classList.remove('modal-open');
      }
    }

    document.getElementById('changePasswordForm').onsubmit = function (event) {
      event.preventDefault(); // Prevent default form submission

      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmNewPassword = document.getElementById('confirmNewPassword').value;

      if (newPassword === confirmNewPassword) {
        const user = auth.currentUser;

        // Reauthenticate the user
        const credential = firebase.auth.EmailAuthProvider.credential(
          user.email,
          currentPassword
        );

        user.reauthenticateWithCredential(credential).then(() => {
          // User reauthenticated, now we can change the password
          user.updatePassword(newPassword).then(() => {
            closeChangePasswordModal();
            showAlert("Password changed successfully!");
          }).catch((error) => {
            console.error("Error updating password: ", error);
            showAlert("Error updating password/Password must be 8 characters long. Please try again.");
          });
        }).catch((error) => {
          console.error("Error reauthenticating: ", error);
          showAlert("Current password is incorrect. Please try again.");
        });
      } else {
        showAlert("New passwords do not match. Please try again.");
      }
    };

    function submitForm() {
      const form = document.getElementById('subscribe-form');
      const email = form.email.value;
  
      // Check if email input is filled
      if (email) {
        window.open(`https://formsubmit.co/el/hocuya?email=${encodeURIComponent(email)}`, '_blank');
        return false;
      }
      return false; 
    }

    // Reference to the active users in Firebase Realtime Database
    const activeUsersRef = database.ref('status');

    // Generate a persistent unique session ID using localStorage
    let sessionId = localStorage.getItem('webcraftSessionId');
    if (!sessionId) {
      sessionId = "user_" + new Date().getTime();
      localStorage.setItem('webcraftSessionId', sessionId);
    }

    const userStatusDatabaseRef = activeUsersRef.child(sessionId);

    // Set user presence (set to true)
    userStatusDatabaseRef.set(true);

    // Remove user presence when they disconnect or close the browser/tab
    userStatusDatabaseRef.onDisconnect().remove();

    // Fetch the number of active users in real-time
    activeUsersRef.on('value', (snapshot) => {
      const activeUserCount = snapshot.numChildren(); // Count active users
      document.getElementById('active-user-count').innerText = activeUserCount;
    });

    // Fetch real-time page views data and display it
    pageViewsRef.on('value', (snapshot) => {
      const data = snapshot.val();
      const analyticsDisplay = document.getElementById('analytics-display');
      analyticsDisplay.innerHTML = '<h2>Page Views:</h2>'; // Reset content

      if (data) {
        for (const key in data) {
          const pageView = data[key];
          analyticsDisplay.innerHTML += `<p>Page: ${pageView.page}, Time: ${new Date(pageView.timestamp).toLocaleString()}</p>`;
        }
      } else {
        analyticsDisplay.innerHTML += '<p>No page view data available.</p>';
      }
    });
  </script>
</body>
</html>